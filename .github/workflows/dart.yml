name: Multi-Platform Build

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'pubspec.yaml'
      - 'lib/utils/app_version.dart'
      - '.github/workflows/dart.yml'

permissions:
  contents: write

env:
  FLUTTER_VERSION: "3.24.0"

jobs:
  # å‡†å¤‡é˜¶æ®µï¼šè¯»å–ç‰ˆæœ¬ã€æ ¡éªŒä¸€è‡´æ€§ã€è‡ªåŠ¨æ‰“ tag
  prepare:
    name: Prepare Release
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      version_tag: ${{ steps.version.outputs.version_tag }}
      should_release: ${{ steps.check.outputs.should_release }}
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract and Validate Version
        id: version
        run: |
          # ä» pubspec.yaml æå–ç‰ˆæœ¬å·ï¼ˆæ ¼å¼ï¼š3.3.1+14ï¼‰
          PUBSPEC_VERSION=$(grep '^version:' pubspec.yaml | sed 's/version: //' | sed 's/+.*//' | xargs)
          echo "pubspec_version=$PUBSPEC_VERSION" >> $GITHUB_OUTPUT
          echo "version=$PUBSPEC_VERSION" >> $GITHUB_OUTPUT
          echo "version_tag=v$PUBSPEC_VERSION" >> $GITHUB_OUTPUT
          echo "âœ… pubspec.yaml version: $PUBSPEC_VERSION"
          
          # ä» lib/utils/app_version.dart æå–ç‰ˆæœ¬å·
          DART_VERSION=$(grep "static const String version = " lib/utils/app_version.dart | sed "s/.*= '//" | sed "s/';//" | xargs)
          echo "dart_version=$DART_VERSION" >> $GITHUB_OUTPUT
          echo "âœ… app_version.dart version: $DART_VERSION"
          
          # æ ¡éªŒç‰ˆæœ¬ä¸€è‡´æ€§
          if [ "$PUBSPEC_VERSION" != "$DART_VERSION" ]; then
            echo "âŒ ç‰ˆæœ¬ä¸ä¸€è‡´ï¼pubspec.yaml ($PUBSPEC_VERSION) != app_version.dart ($DART_VERSION)"
            exit 1
          fi
          
          echo "âœ… æ‰€æœ‰ç‰ˆæœ¬å·ä¸€è‡´ï¼š$PUBSPEC_VERSION"

      - name: Check if Tag Exists
        id: check
        run: |
          VERSION_TAG="v${{ steps.version.outputs.version }}"
          
          # æ£€æŸ¥ tag æ˜¯å¦å­˜åœ¨
          if git rev-parse "$VERSION_TAG" >/dev/null 2>&1; then
            echo "âš ï¸  Tag $VERSION_TAG å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
            echo "should_release=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… Tag $VERSION_TAG ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–° tag"
            echo "should_release=true" >> $GITHUB_OUTPUT
          fi

      - name: Create and Push Tag
        if: steps.check.outputs.should_release == 'true'
        run: |
          VERSION_TAG="v${{ steps.version.outputs.version }}"
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git tag -a "$VERSION_TAG" -m "Release $VERSION_TAG"
          git push origin "$VERSION_TAG"
          echo "âœ… Tag $VERSION_TAG å·²åˆ›å»ºå¹¶æ¨é€"

  # iOS æ„å»º
  build-ios:
    needs: prepare
    if: needs.prepare.outputs.should_release == 'true'
    name: iOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          architecture: x64
          cache: true

      - name: Cache CocoaPods
        uses: actions/cache@v4
        with:
          path: |
            ios/Pods
            ~/Library/Caches/CocoaPods
          key: ${{ runner.os }}-pods-${{ hashFiles('ios/Podfile.lock') }}
          restore-keys: |
            ${{ runner.os }}-pods-

      - name: Install Dependencies
        run: flutter pub get

      - name: Install CocoaPods
        run: pod install --repo-update
        working-directory: ios

      - name: Build iOS Release
        run: flutter build ios --release --no-codesign

      - name: Create IPA
        run: |
          mkdir Payload
          mv Runner.app/ Payload
          zip -qq -r -9 Agrisale-ios-${{ needs.prepare.outputs.version_tag }}.ipa Payload
        working-directory: build/ios/iphoneos

      - name: Upload iOS Artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS-Build
          path: build/ios/iphoneos/Agrisale-ios-${{ needs.prepare.outputs.version_tag }}.ipa
          retention-days: 1

  # Android æ„å»º
  build-android:
    needs: prepare
    if: needs.prepare.outputs.should_release == 'true'
    name: Android Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Cache Gradle
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('android/**/*.gradle*', 'android/**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      - name: Install Dependencies
        run: flutter pub get

      - name: Fix share_plus build.gradle
        run: |
          python3 << 'PYEOF'
          import os
          import re
          
          # ä¿®å¤ share_plus æ’ä»¶çš„ build.gradle æ–‡ä»¶
          share_plus_build_gradle = os.path.join(os.path.expanduser('~'), '.pub-cache', 'hosted', 'pub.dev', 'share_plus-12.0.1', 'android', 'build.gradle')
          if os.path.isfile(share_plus_build_gradle):
              print(f'æ‰¾åˆ° share_plus build.gradle: {share_plus_build_gradle}')
              with open(share_plus_build_gradle, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              # ä¿®å¤ compileSdk = flutter.compileSdkVersion ä¸º compileSdk = 35
              if 'compileSdk = flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdk = flutter.compileSdkVersion', 'compileSdk = 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdk é…ç½®')
              elif 'compileSdk flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdk flutter.compileSdkVersion', 'compileSdk 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdk é…ç½®')
              elif 'compileSdkVersion flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdkVersion flutter.compileSdkVersion', 'compileSdkVersion 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdkVersion é…ç½®')
              else:
                  print('âœ“ share_plus build.gradle ä¸­æœªå‘ç°éœ€è¦ä¿®å¤çš„ compileSdk é…ç½®')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° share_plus build.gradle: {share_plus_build_gradle}')
          PYEOF

      - name: Fix install_plugin namespace and AndroidManifest
        run: |
          python3 << 'PYEOF'
          import re
          import os
          
          home = os.environ.get('HOME', os.path.expanduser('~'))
          
          # ä¿®å¤ build.gradle - æ·»åŠ  namespace å’Œç»Ÿä¸€ JVM ç›®æ ‡ç‰ˆæœ¬ä¸º 17
          build_gradle_path = os.path.join(home, '.pub-cache', 'hosted', 'pub.dev', 'install_plugin-2.1.0', 'android', 'build.gradle')
          if os.path.isfile(build_gradle_path):
              print(f'æ‰¾åˆ° build.gradle: {build_gradle_path}')
              with open(build_gradle_path, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              has_changes = False
              
              # æ·»åŠ  namespace
              if 'namespace' not in content:
                  pattern = r'(android\s*\{)'
                  replacement = r'\1\n    namespace "com.crazecoder.openfile"'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  namespace åˆ° build.gradle')
              else:
                  print('âœ“ build.gradle å·²åŒ…å« namespace')
              
              # ä¿®å¤ compileSdkVersion
              if 'compileSdkVersion' in content:
                  match = re.search(r'compileSdkVersion\s+(\d+)', content)
                  if match:
                      current_sdk = int(match.group(1))
                      if current_sdk < 35:
                          content = re.sub(r'compileSdkVersion\s+\d+', 'compileSdkVersion 35', content)
                          has_changes = True
                          print(f'âœ“ å·²æ›´æ–° compileSdkVersion ä» {current_sdk} åˆ° 35')
                      else:
                          print(f'âœ“ compileSdkVersion å·²è®¾ç½®ä¸º {current_sdk}')
                  else:
                      content = re.sub(r'compileSdkVersion\s*[^\n]+', 'compileSdkVersion 35', content)
                      has_changes = True
                      print('âœ“ å·²è®¾ç½® compileSdkVersion ä¸º 35')
              
              # ç»Ÿä¸€ JVM ç›®æ ‡ç‰ˆæœ¬ä¸º 17ï¼ˆä¸ GitHub Actions Java ç‰ˆæœ¬ä¸€è‡´ï¼‰
              # æ›¿æ¢ Java ç‰ˆæœ¬
              if 'VERSION_1_8' in content:
                  content = re.sub(r'VERSION_1_8', 'VERSION_17', content)
                  has_changes = True
                  print('âœ“ å·²æ›´æ–° Java ç‰ˆæœ¬ä» 1.8 åˆ° 17')
              if 'VERSION_11' in content:
                  content = re.sub(r'VERSION_11', 'VERSION_17', content)
                  has_changes = True
                  print('âœ“ å·²æ›´æ–° Java ç‰ˆæœ¬ä» 11 åˆ° 17')
              
              # æ›¿æ¢ Kotlin jvmTarget
              if 'jvmTarget' in content:
                  content = re.sub(r'jvmTarget\s*=\s*["\']1\.8["\']', 'jvmTarget = "17"', content)
                  content = re.sub(r'jvmTarget\s*=\s*["\']11["\']', 'jvmTarget = "17"', content)
                  has_changes = True
                  print('âœ“ kotlinOptions jvmTarget å·²è®¾ç½®ä¸º 17')
              
              # ç¡®ä¿æœ‰ compileOptions å’Œ kotlinOptions é…ç½®
              if 'compileOptions' not in content:
                  # åœ¨ android { åæ·»åŠ  compileOptions
                  pattern = r'(android\s*\{[^\}]*namespace[^\n]*\n)'
                  compile_opts = '\\1\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_17\n        targetCompatibility JavaVersion.VERSION_17\n    }\n    kotlinOptions {\n        jvmTarget = "17"\n    }\n'
                  content = re.sub(pattern, compile_opts, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  compileOptions å’Œ kotlinOptions é…ç½®')
              
              if has_changes:
                  with open(build_gradle_path, 'w', encoding='utf-8') as f:
                      f.write(content)
                  print('âœ“ build.gradle ä¿®å¤å®Œæˆ')
                  print('--- ä¿®å¤åçš„å†…å®¹ ---')
                  print(content[:2000])
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° build.gradle: {build_gradle_path}')
          
          # ä¿®å¤ AndroidManifest.xml - ç§»é™¤ package å±æ€§
          manifest_path = os.path.join(home, '.pub-cache', 'hosted', 'pub.dev', 'install_plugin-2.1.0', 'android', 'src', 'main', 'AndroidManifest.xml')
          if os.path.isfile(manifest_path):
              print(f'æ‰¾åˆ° AndroidManifest.xml: {manifest_path}')
              with open(manifest_path, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              if 'package=' in content:
                  pattern = r'\s*package\s*=\s*["\'][^"\']*["\']'
                  new_content = re.sub(pattern, '', content)
                  with open(manifest_path, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ç§»é™¤ AndroidManifest.xml ä¸­çš„ package å±æ€§')
              else:
                  print('âœ“ AndroidManifest.xml ä¸­å·²æ—  package å±æ€§')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° AndroidManifest.xml: {manifest_path}')
          PYEOF

      - name: Restore Android keystore
        run: |
          if [ -n "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" ]; then
            echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/agrisale-release.jks
            chmod 600 android/app/agrisale-release.jks
            echo "âœ… Keystore restored"
          else
            echo "âš ï¸ Warning: ANDROID_KEYSTORE_BASE64 secret not set, will use debug signing"
          fi

      - name: Create key.properties
        run: |
          if [ -n "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" ]; then
            cat <<EOF > android/key.properties
          storePassword=${{ secrets.ANDROID_STORE_PASSWORD }}
          keyPassword=${{ secrets.ANDROID_KEY_PASSWORD }}
          keyAlias=${{ secrets.ANDROID_KEY_ALIAS }}
          storeFile=agrisale-release.jks
          EOF
            echo "âœ… key.properties created"
          else
            echo "âš ï¸ Warning: key.properties not created, will use debug signing"
          fi

      - name: Build Android APK
        run: flutter build apk --release

      - name: Rename APK File
        run: |
          mv build/app/outputs/flutter-apk/app-release.apk build/app/outputs/flutter-apk/Agrisale-android-${{ needs.prepare.outputs.version_tag }}.apk

      - name: Upload Android APK
        uses: actions/upload-artifact@v4
        with:
          name: Android-APK
          path: build/app/outputs/flutter-apk/Agrisale-android-${{ needs.prepare.outputs.version_tag }}.apk
          retention-days: 1

  # macOS æ„å»º
  build-macos:
    needs: prepare
    if: needs.prepare.outputs.should_release == 'true'
    name: macOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          architecture: x64
          cache: true

      - name: Cache CocoaPods
        uses: actions/cache@v4
        with:
          path: |
            macos/Pods
            ~/Library/Caches/CocoaPods
          key: ${{ runner.os }}-macos-pods-${{ hashFiles('macos/Podfile.lock') }}
          restore-keys: |
            ${{ runner.os }}-macos-pods-

      - name: Enable macOS Desktop
        run: flutter config --enable-macos-desktop

      - name: Install Dependencies
        run: flutter pub get

      - name: Install CocoaPods
        run: pod install --repo-update
        working-directory: macos

      - name: Build macOS Release
        run: flutter build macos --release

      - name: Create macOS DMG
        run: |
          # åˆ›å»ºä¸´æ—¶ç›®å½•ç”¨äº DMG å†…å®¹
          mkdir -p dmg_temp
          cp -R build/macos/Build/Products/Release/agrisale.app dmg_temp/
          
          # åˆ›å»º Applications æ–‡ä»¶å¤¹çš„ç¬¦å·é“¾æ¥
          ln -s /Applications dmg_temp/Applications
          
          # åˆ›å»º DMG æ–‡ä»¶
          hdiutil create -volname "Agrisale" \
            -srcfolder dmg_temp \
            -ov -format UDZO \
            Agrisale-macos-${{ needs.prepare.outputs.version_tag }}.dmg
          
          # æ¸…ç†ä¸´æ—¶ç›®å½•
          rm -rf dmg_temp

      - name: Upload macOS DMG Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macOS-DMG
          path: Agrisale-macos-${{ needs.prepare.outputs.version_tag }}.dmg
          retention-days: 1

  # Windows æ„å»º
  build-windows:
    needs: prepare
    if: needs.prepare.outputs.should_release == 'true'
    name: Windows Build
    runs-on: windows-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: Enable Windows Desktop
        run: flutter config --enable-windows-desktop

      - name: Install Dependencies
        run: flutter pub get

      - name: Build Windows Release
        run: flutter build windows --release

      - name: Install Inno Setup
        run: |
          choco install innosetup -y

      - name: Download Chinese Language File for Inno Setup
        run: |
          $langUrl = "https://raw.githubusercontent.com/jrsoftware/issrc/main/Files/Languages/Unofficial/ChineseSimplified.isl"
          $langPath = "C:\Program Files (x86)\Inno Setup 6\Languages\ChineseSimplified.isl"
          Invoke-WebRequest -Uri $langUrl -OutFile $langPath
          Write-Host "âœ… Downloaded ChineseSimplified.isl"

      - name: Create Inno Setup Script
        run: |
          $version = "${{ needs.prepare.outputs.version_tag }}".TrimStart('v')
          $issContent = @"
          [Setup]
          AppName=Agrisale
          AppVersion=$version
          AppPublisher=drflo.org
          AppPublisherURL=https://agrisale.drflo.org
          DefaultDirName={autopf}\Agrisale
          DefaultGroupName=Agrisale
          OutputDir=.
          OutputBaseFilename=Agrisale-windows-${{ needs.prepare.outputs.version_tag }}-installer
          Compression=lzma2
          SolidCompression=yes
          ArchitecturesAllowed=x64
          ArchitecturesInstallIn64BitMode=x64
          PrivilegesRequired=admin
          SetupIconFile=windows\runner\resources\app_icon.ico
          UninstallDisplayIcon={app}\agrisale.exe
          
          [Languages]
          Name: "chinesesimplified"; MessagesFile: "compiler:Languages\ChineseSimplified.isl"
          Name: "english"; MessagesFile: "compiler:Default.isl"
          
          [Tasks]
          Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked
          
          [Files]
          Source: "build\windows\x64\runner\Release\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs
          
          [Icons]
          Name: "{group}\Agrisale"; Filename: "{app}\agrisale.exe"
          Name: "{group}\{cm:UninstallProgram,Agrisale}"; Filename: "{uninstallexe}"
          Name: "{autodesktop}\Agrisale"; Filename: "{app}\agrisale.exe"; Tasks: desktopicon
          
          [Run]
          Filename: "{app}\agrisale.exe"; Description: "{cm:LaunchProgram,Agrisale}"; Flags: nowait postinstall skipifsilent
          "@
          [System.IO.File]::WriteAllText("setup.iss", $issContent, [System.Text.Encoding]::UTF8)

      - name: Build Windows Installer
        run: |
          & "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" setup.iss

      - name: Upload Windows Installer Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows-Installer
          path: Agrisale-windows-${{ needs.prepare.outputs.version_tag }}-installer.exe
          retention-days: 1

  # åˆ›å»º GitHub Release
  create-release:
    name: Create Release
    needs: [prepare, build-ios, build-android, build-macos, build-windows]
    runs-on: ubuntu-latest
    if: needs.prepare.outputs.should_release == 'true'
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: Display structure of downloaded files
        run: ls -la artifacts/

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ needs.prepare.outputs.version_tag }}
          name: "Agrisale ${{ needs.prepare.outputs.version_tag }}"
          body: |
            ## Agrisale ${{ needs.prepare.outputs.version_tag }}
            
            ### æ”¯æŒå¹³å°
            - iOS: iPhone å’Œ iPad
            - Android: æ‰‹æœºå’Œå¹³æ¿
            - macOS: Mac æ¡Œé¢åº”ç”¨
            - Windows: Windows æ¡Œé¢åº”ç”¨
            
            ### ä¸»è¦åŠŸèƒ½
            - äº§å“åº“å­˜ç®¡ç†
            - é‡‡è´­é”€å”®ç®¡ç†
            - å®¢æˆ·ä¾›åº”å•†ç®¡ç†
            - è´¢åŠ¡æŠ¥è¡¨ç»Ÿè®¡
            - AI æ•°æ®åŠ©æ‰‹
            - æ•°æ®å¤‡ä»½æ¢å¤
            - å¤šç”¨æˆ·ç³»ç»Ÿ
            
            ### v3.4.0 æ›´æ–°å†…å®¹ ğŸš€
            
            #### ğŸ“Š æ•°æ®ç»Ÿè®¡å¢å¼º
            - **æ€»è®°å½•æ•°æ˜¾ç¤º**ï¼šé‡‡è´­/é”€å”®/é€€è´§ç•Œé¢æ–°å¢æ€»è®°å½•æ•°ç»Ÿè®¡
            - **è´¢åŠ¡ç»Ÿè®¡ä¼˜åŒ–**ï¼šUIæ”¹è¿›ï¼Œè´Ÿæ•°é‡‘é¢è§„èŒƒæ˜¾ç¤ºï¼ˆ-Â¥xx.xxæ ¼å¼ï¼‰
            
            #### ğŸ“‹ æ—¥å¿—ä¸è¯¦æƒ…åŠŸèƒ½
            - **æ“ä½œæ—¥å¿—ç³»ç»Ÿ**ï¼šæ–°å¢å®Œæ•´çš„æ“ä½œæ—¥å¿—åŠŸèƒ½ï¼Œè®°å½•åˆ›å»º/ä¿®æ”¹/åˆ é™¤/è¦†ç›–æ“ä½œ
            - **è®°å½•è¯¦æƒ…çª—å£**ï¼šé‡‡è´­/é”€å”®/é€€è´§/è¿›è´¦/æ±‡æ¬¾æ”¯æŒæŸ¥çœ‹å®Œæ•´æ•°æ®å’Œæ“ä½œå†å²
            - **å®ä½“è¯¦æƒ…çª—å£**ï¼šäº§å“/å®¢æˆ·/ä¾›åº”å•†/å‘˜å·¥æ”¯æŒæŸ¥çœ‹è¯¦æƒ…å’Œæ“ä½œå†å²
            
            #### ğŸ›¡ï¸ é²æ£’æ€§å¢å¼º
            - **UIæº¢å‡ºé˜²æŠ¤**ï¼šå¤šå¤„ç•Œé¢å¢åŠ æº¢å‡ºä¿æŠ¤ï¼Œæ”¯æŒæ¨ªå‘æ»‘åŠ¨æŸ¥çœ‹é•¿å†…å®¹
            - **æ ‡é¢˜æ»‘åŠ¨æ”¯æŒ**ï¼šå¯¹è´¦å•ã€è®°å½•ç­‰é¡µé¢æ ‡é¢˜æ”¯æŒæ»‘åŠ¨æŸ¥çœ‹å®Œæ•´å†…å®¹
            - **æ±‡æ€»ä¿¡æ¯ä¼˜åŒ–**ï¼šæ±‡æ€»ç»Ÿè®¡å¡ç‰‡åœ¨çª„å±å¹•ä¸‹æ”¯æŒæ¨ªå‘æ»‘åŠ¨
            
            #### âœï¸ è¾“å…¥é™åˆ¶
            - **åç§°å­—æ•°é™åˆ¶**ï¼šäº§å“/å®¢æˆ·/ä¾›åº”å•†/å‘˜å·¥åç§°é™åˆ¶15ä¸ªæ±‰å­—æˆ–30ä¸ªå­—æ¯
            - **å¤‡æ³¨å­—æ•°é™åˆ¶**ï¼šæè¿°/å¤‡æ³¨å†…å®¹é™åˆ¶100ä¸ªæ±‰å­—æˆ–200ä¸ªå­—æ¯
            - **å®æ—¶è®¡æ•°æ˜¾ç¤º**ï¼šè¾“å…¥æ¡†å³ä¸‹è§’æ˜¾ç¤ºå­—æ•°è®¡æ•°å™¨
            - **æ•°å€¼æé™é™åˆ¶**ï¼šæ•°é‡ç±»å­—æ®µé™åˆ¶çº¦1äº¿ï¼Œé‡‘é¢ç±»å­—æ®µé™åˆ¶çº¦100äº¿
            
            #### ğŸ¨ ç•Œé¢ä¼˜åŒ–
            - **ä¸‹æ‹‰æ¡†æ ·å¼ç»Ÿä¸€**ï¼šäº§å“ç¼–è¾‘æ¡†ä¸­ä¾›åº”å•†å’Œå•ä½é€‰æ‹©æ¡†æ ·å¼ä¸å…¶ä»–è¾“å…¥æ¡†ä¸€è‡´
            - **è¯¦æƒ…çª—å£å¯¼èˆª**ï¼šå®ä½“è¯¦æƒ…çª—å£é›†æˆå¿«æ·å¯¼èˆªæŒ‰é’®
            
            ### ğŸ“¥ ä¸‹è½½è¯´æ˜
            
            #### iOS ç”¨æˆ·
            - ä¸‹è½½ `Agrisale-ios-${{ needs.prepare.outputs.version_tag }}.ipa` æ–‡ä»¶
            - éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ AltStore æˆ–ä¼ä¸šè¯ä¹¦å®‰è£…
            
            #### Android ç”¨æˆ·
            - ä¸‹è½½ `Agrisale-android-${{ needs.prepare.outputs.version_tag }}.apk` æ–‡ä»¶
            - å¼€å¯"æœªçŸ¥æ¥æºåº”ç”¨"åç›´æ¥å®‰è£…
            
            #### macOS ç”¨æˆ·
            - ä¸‹è½½ `Agrisale-macos-${{ needs.prepare.outputs.version_tag }}.dmg` æ–‡ä»¶
            - åŒå‡» DMG æ–‡ä»¶ï¼Œå°† agrisale.app æ‹–æ‹½åˆ° Applications æ–‡ä»¶å¤¹
            - é¦–æ¬¡æ‰“å¼€å¯èƒ½éœ€è¦åœ¨"ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§"ä¸­å…è®¸
            
            #### Windows ç”¨æˆ·
            - ä¸‹è½½ `Agrisale-windows-${{ needs.prepare.outputs.version_tag }}-installer.exe` æ–‡ä»¶
            - åŒå‡»è¿è¡Œå®‰è£…ç¨‹åºï¼ŒæŒ‰ç…§å®‰è£…å‘å¯¼å®Œæˆå®‰è£…
            - æ”¯æŒç®€ä½“ä¸­æ–‡å®‰è£…ç•Œé¢
            
            ---
            
            å®Œæ•´è·¨å¹³å°æ”¯æŒ | åŸç”Ÿç”¨æˆ·ä½“éªŒ | å¼€æºå…è´¹
          files: |
            artifacts/iOS-Build/Agrisale-ios-${{ needs.prepare.outputs.version_tag }}.ipa
            artifacts/Android-APK/Agrisale-android-${{ needs.prepare.outputs.version_tag }}.apk
            artifacts/macOS-DMG/Agrisale-macos-${{ needs.prepare.outputs.version_tag }}.dmg
            artifacts/Windows-Installer/Agrisale-windows-${{ needs.prepare.outputs.version_tag }}-installer.exe
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
