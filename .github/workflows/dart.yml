name: Multi-Platform Build

on:
  workflow_dispatch:
  push:
    tags:
      - 'v*'

env:
  FLUTTER_VERSION: "3.24.0"
  VERSION_TAG: "v3.0.0"

jobs:
  # iOS æ„å»º
  build-ios:
    name: iOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          architecture: x64

      - name: Install Dependencies
        run: flutter pub get

      - name: Update CocoaPods
        run: pod repo update
        working-directory: ios

      - name: Build iOS Release
        run: flutter build ios --release --no-codesign

      - name: Create IPA
        run: |
          mkdir Payload
          mv Runner.app/ Payload
          zip -qq -r -9 agrisale-ios-${{ env.VERSION_TAG }}.ipa Payload
        working-directory: build/ios/iphoneos

      - name: Upload iOS Artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS-Build
          path: build/ios/iphoneos/agrisale-ios-${{ env.VERSION_TAG }}.ipa

  # Android æ„å»º
  build-android:
    name: Android Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'

      - name: Install Dependencies
        run: flutter pub get

      - name: Clean Build
        run: flutter clean

      - name: Get Dependencies Again
        run: flutter pub get

      - name: Fix share_plus build.gradle
        run: |
          python3 << 'PYEOF'
          import os
          import re
          
          # ä¿®å¤ share_plus æ’ä»¶çš„ build.gradle æ–‡ä»¶
          share_plus_build_gradle = os.path.join(os.path.expanduser('~'), '.pub-cache', 'hosted', 'pub.dev', 'share_plus-12.0.1', 'android', 'build.gradle')
          if os.path.isfile(share_plus_build_gradle):
              print(f'æ‰¾åˆ° share_plus build.gradle: {share_plus_build_gradle}')
              with open(share_plus_build_gradle, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              # ä¿®å¤ compileSdk = flutter.compileSdkVersion ä¸º compileSdk = 35
              if 'compileSdk = flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdk = flutter.compileSdkVersion', 'compileSdk = 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdk é…ç½®')
              elif 'compileSdk flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdk flutter.compileSdkVersion', 'compileSdk 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdk é…ç½®')
              elif 'compileSdkVersion flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdkVersion flutter.compileSdkVersion', 'compileSdkVersion 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdkVersion é…ç½®')
              else:
                  print('âœ“ share_plus build.gradle ä¸­æœªå‘ç°éœ€è¦ä¿®å¤çš„ compileSdk é…ç½®')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° share_plus build.gradle: {share_plus_build_gradle}')
          PYEOF

      - name: Fix install_plugin namespace and AndroidManifest
        run: |
          python3 << 'PYEOF'
          import re
          import os
          
          home = os.environ.get('HOME', os.path.expanduser('~'))
          
          # ä¿®å¤ build.gradle - æ·»åŠ  namespace å’Œç»Ÿä¸€ JVM ç›®æ ‡ç‰ˆæœ¬
          build_gradle_path = os.path.join(home, '.pub-cache', 'hosted', 'pub.dev', 'install_plugin-2.1.0', 'android', 'build.gradle')
          if os.path.isfile(build_gradle_path):
              print(f'æ‰¾åˆ° build.gradle: {build_gradle_path}')
              with open(build_gradle_path, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              has_changes = False
              
              # æ·»åŠ  namespace
              if 'namespace' not in content:
                  pattern = r'(android\s*\{)'
                  replacement = r'\1\n    namespace "com.crazecoder.openfile"'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  namespace åˆ° build.gradle')
              else:
                  print('âœ“ build.gradle å·²åŒ…å« namespace')
              
              # ä¿®å¤ compileSdkVersion - ç¡®ä¿è‡³å°‘ä¸º 30ï¼ˆJava 9+ è¦æ±‚ï¼‰ï¼Œæœ€å¥½è®¾ç½®ä¸º 35
              if 'compileSdkVersion' in content:
                  # æ£€æŸ¥å½“å‰çš„ compileSdkVersion å€¼
                  match = re.search(r'compileSdkVersion\s+(\d+)', content)
                  if match:
                      current_sdk = int(match.group(1))
                      if current_sdk < 35:
                          content = re.sub(r'compileSdkVersion\s+\d+', 'compileSdkVersion 35', content)
                          has_changes = True
                          print(f'âœ“ å·²æ›´æ–° compileSdkVersion ä» {current_sdk} åˆ° 35')
                      else:
                          print(f'âœ“ compileSdkVersion å·²è®¾ç½®ä¸º {current_sdk}')
                  else:
                      # å¦‚æœæ ¼å¼ä¸åŒï¼Œå°è¯•æ›¿æ¢
                      content = re.sub(r'compileSdkVersion\s*[^\n]+', 'compileSdkVersion 35', content)
                      has_changes = True
                      print('âœ“ å·²è®¾ç½® compileSdkVersion ä¸º 35')
              else:
                  # å¦‚æœæ²¡æœ‰ compileSdkVersionï¼Œæ·»åŠ å®ƒï¼ˆåœ¨ namespace ä¹‹åï¼‰
                  if 'namespace' in content:
                      pattern = r'(namespace\s+"[^"]+"\s*\n)'
                      replacement = r'\1    compileSdkVersion 35\n'
                      content = re.sub(pattern, replacement, content, count=1)
                      has_changes = True
                      print('âœ“ å·²æ·»åŠ  compileSdkVersion 35')
                  elif 'android {' in content:
                      pattern = r'(android\s*\{)'
                      replacement = r'\1\n    compileSdkVersion 35'
                      content = re.sub(pattern, replacement, content, count=1)
                      has_changes = True
                      print('âœ“ å·²æ·»åŠ  compileSdkVersion 35')
              
              # ç»Ÿä¸€ JVM ç›®æ ‡ç‰ˆæœ¬ä¸º 11ï¼ˆä¸é¡¹ç›®é…ç½®ä¸€è‡´ï¼‰
              # ä¿®å¤ compileOptions - å°† Java 1.8 æ”¹ä¸º 11
              if 'VERSION_1_8' in content:
                  content = re.sub(r'VERSION_1_8', 'VERSION_11', content)
                  has_changes = True
                  print('âœ“ å·²æ›´æ–° Java ç‰ˆæœ¬ä» 1.8 åˆ° 11')
              
              # ä¿®å¤ kotlinOptions - å°† jvmTarget 1.8 æ”¹ä¸º 11
              if 'jvmTarget' in content:
                  # åŒ¹é… jvmTarget = "1.8" æˆ– jvmTarget = '1.8'
                  content = re.sub(r'jvmTarget\s*=\s*["\']1\.8["\']', 'jvmTarget = "11"', content)
                  if 'jvmTarget = "11"' in content or "jvmTarget = '11'" in content:
                      print('âœ“ kotlinOptions jvmTarget å·²è®¾ç½®ä¸º 11')
                  else:
                      has_changes = True
                      print('âœ“ å·²æ›´æ–° kotlinOptions jvmTarget åˆ° 11')
              
              # å¦‚æœæ²¡æœ‰ compileOptionsï¼Œæ·»åŠ å®ƒ
              if 'compileOptions' not in content and 'android {' in content:
                  # åœ¨ android { åæ·»åŠ  compileOptions
                  pattern = r'(android\s*\{)'
                  replacement = r'\1\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_11\n        targetCompatibility JavaVersion.VERSION_11\n    }'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  compileOptions é…ç½®')
              
              # å¦‚æœæ²¡æœ‰ kotlinOptionsï¼Œæ·»åŠ å®ƒ
              if 'kotlinOptions' not in content and 'compileOptions' in content:
                  # åœ¨ compileOptions åæ·»åŠ  kotlinOptions
                  pattern = r'(compileOptions\s*\{[^\}]*?\})'
                  replacement = r'\1\n    kotlinOptions {\n        jvmTarget = "11"\n    }'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  kotlinOptions é…ç½®')
              
              if has_changes:
                  with open(build_gradle_path, 'w', encoding='utf-8') as f:
                      f.write(content)
                  print('âœ“ build.gradle ä¿®å¤å®Œæˆ')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° build.gradle: {build_gradle_path}')
          
          # ä¿®å¤ AndroidManifest.xml - ç§»é™¤ package å±æ€§
          manifest_path = os.path.join(home, '.pub-cache', 'hosted', 'pub.dev', 'install_plugin-2.1.0', 'android', 'src', 'main', 'AndroidManifest.xml')
          if os.path.isfile(manifest_path):
              print(f'æ‰¾åˆ° AndroidManifest.xml: {manifest_path}')
              with open(manifest_path, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              # ç§»é™¤ package å±æ€§
              if 'package=' in content:
                  # åŒ¹é… package="..." æˆ– package='...'
                  pattern = r'\s*package\s*=\s*["\'][^"\']*["\']'
                  new_content = re.sub(pattern, '', content)
                  
                  with open(manifest_path, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ç§»é™¤ AndroidManifest.xml ä¸­çš„ package å±æ€§')
              else:
                  print('âœ“ AndroidManifest.xml ä¸­å·²æ—  package å±æ€§')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° AndroidManifest.xml: {manifest_path}')
          

      - name: Restore Android keystore
        run: |
          if [ -n "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" ]; then
            echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/agrisale-release.jks
            echo "âœ“ Keystore restored to android/app/agrisale-release.jks"
          else
            echo "âš ï¸ Warning: ANDROID_KEYSTORE_BASE64 secret not set, will use debug signing"
          fi

      - name: Create key.properties
        run: |
          if [ -n "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" ]; then
            cat <<EOF > android/key.properties
          storePassword=${{ secrets.ANDROID_STORE_PASSWORD }}
          keyPassword=${{ secrets.ANDROID_KEY_PASSWORD }}
          keyAlias=${{ secrets.ANDROID_KEY_ALIAS }}
          storeFile=agrisale-release.jks
          EOF
            echo "âœ“ key.properties created in android/ directory"
          else
            echo "âš ï¸ Warning: key.properties not created, will use debug signing"
          fi

      - name: Build Android APK
        run: flutter build apk --release

      - name: Rename APK File
        run: |
          mv build/app/outputs/flutter-apk/app-release.apk build/app/outputs/flutter-apk/agrisale-android-${{ env.VERSION_TAG }}.apk

      - name: Upload Android APK
        uses: actions/upload-artifact@v4
        with:
          name: Android-APK
          path: build/app/outputs/flutter-apk/agrisale-android-${{ env.VERSION_TAG }}.apk

  # macOS æ„å»º
  build-macos:
    name: macOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          architecture: x64

      - name: Enable macOS Desktop
        run: flutter config --enable-macos-desktop

      - name: Install Dependencies
        run: flutter pub get

      - name: Update CocoaPods
        run: pod repo update
        working-directory: macos

      - name: Build macOS Release
        run: flutter build macos --release

      - name: Create macOS ZIP Archive
        run: |
          cd build/macos/Build/Products/Release
          zip -qq -r -9 ../../../../../agrisale-macos-${{ env.VERSION_TAG }}.zip agrisale.app

      - name: Create macOS DMG
        run: |
          # åˆ›å»ºä¸´æ—¶ç›®å½•ç”¨äº DMG å†…å®¹
          mkdir -p dmg_temp
          cp -R build/macos/Build/Products/Release/agrisale.app dmg_temp/
          
          # åˆ›å»º Applications æ–‡ä»¶å¤¹çš„ç¬¦å·é“¾æ¥
          ln -s /Applications dmg_temp/Applications
          
          # åˆ›å»º DMG æ–‡ä»¶
          hdiutil create -volname "Agrisale" \
            -srcfolder dmg_temp \
            -ov -format UDZO \
            agrisale-macos-${{ env.VERSION_TAG }}.dmg
          
          # æ¸…ç†ä¸´æ—¶ç›®å½•
          rm -rf dmg_temp

      - name: Upload macOS ZIP Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macOS-ZIP
          path: agrisale-macos-${{ env.VERSION_TAG }}.zip

      - name: Upload macOS DMG Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macOS-DMG
          path: agrisale-macos-${{ env.VERSION_TAG }}.dmg

  # Windows æ„å»º
  build-windows:
    name: Windows Build
    runs-on: windows-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'

      - name: Enable Windows Desktop
        run: flutter config --enable-windows-desktop

      - name: Install Dependencies
        run: flutter pub get

      - name: Build Windows Release
        run: flutter build windows --release

      - name: Create Windows ZIP Archive
        run: |
          Compress-Archive -Path "build\windows\x64\runner\Release\*" -DestinationPath "agrisale-windows-${{ env.VERSION_TAG }}.zip"

      - name: Install Inno Setup
        run: |
          choco install innosetup -y

      - name: Create Inno Setup Script
        run: |
          $version = "${{ env.VERSION_TAG }}".TrimStart('v')
          @"
          [Setup]
          AppName=Agrisale
          AppVersion=$version
          AppPublisher=Agrisale Team
          AppPublisherURL=https://github.com/yourusername/agrisale
          DefaultDirName={autopf}\Agrisale
          DefaultGroupName=Agrisale
          OutputDir=.
          OutputBaseFilename=agrisale-windows-${{ env.VERSION_TAG }}-installer
          Compression=lzma2
          SolidCompression=yes
          ArchitecturesAllowed=x64
          ArchitecturesInstallIn64BitMode=x64
          PrivilegesRequired=admin
          SetupIconFile=windows\runner\resources\app_icon.ico
          UninstallDisplayIcon={app}\agrisale.exe
          
          [Languages]
          Name: "english"; MessagesFile: "compiler:Default.isl"
          Name: "chinesesimp"; MessagesFile: "compiler:Languages\ChineseSimplified.isl"
          
          [Tasks]
          Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked
          
          [Files]
          Source: "build\windows\x64\runner\Release\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs
          
          [Icons]
          Name: "{group}\Agrisale"; Filename: "{app}\agrisale.exe"
          Name: "{group}\{cm:UninstallProgram,Agrisale}"; Filename: "{uninstallexe}"
          Name: "{autodesktop}\Agrisale"; Filename: "{app}\agrisale.exe"; Tasks: desktopicon
          
          [Run]
          Filename: "{app}\agrisale.exe"; Description: "{cm:LaunchProgram,Agrisale}"; Flags: nowait postinstall skipifsilent
          "@ | Out-File -FilePath "setup.iss" -Encoding UTF8

      - name: Build Windows Installer
        run: |
          & "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" setup.iss

      - name: Upload Windows ZIP Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows-ZIP
          path: agrisale-windows-${{ env.VERSION_TAG }}.zip

      - name: Upload Windows Installer Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows-Installer
          path: agrisale-windows-${{ env.VERSION_TAG }}-installer.exe

  # åˆ›å»º GitHub Release
  create-release:
    name: Create Release
    needs: [build-ios, build-android, build-macos, build-windows]
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' || startsWith(github.ref, 'refs/tags/')
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: Display structure of downloaded files
        run: ls -la artifacts/

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.VERSION_TAG }}
          name: "Agrisale ${{ env.VERSION_TAG }}"
          body: |
            ## Agrisale ${{ env.VERSION_TAG }}
            
            ### æ”¯æŒå¹³å°
            - iOS: iPhone å’Œ iPad
            - Android: æ‰‹æœºå’Œå¹³æ¿
            - macOS: Mac æ¡Œé¢åº”ç”¨
            - Windows: Windows æ¡Œé¢åº”ç”¨
            
            ### ä¸»è¦åŠŸèƒ½
            - äº§å“åº“å­˜ç®¡ç†
            - é‡‡è´­é”€å”®ç®¡ç†
            - å®¢æˆ·ä¾›åº”å•†ç®¡ç†
            - è´¢åŠ¡æŠ¥è¡¨ç»Ÿè®¡
            - AI æ•°æ®åŠ©æ‰‹
            - æ•°æ®å¤‡ä»½æ¢å¤
            - å¤šç”¨æˆ·ç³»ç»Ÿ
            
            ### v3.0.0 æ›´æ–°å†…å®¹ ğŸš€
            
            #### âœ¨ æ–°åŠŸèƒ½
            - **PDF å¯¼å‡ºåŠŸèƒ½**ï¼šæ–°å¢ PDF æ ¼å¼å¯¼å‡ºï¼Œæ”¯æŒæ‰€æœ‰æŠ¥è¡¨å¯¼å‡ºä¸º PDF æ–‡ä»¶ï¼Œä¾¿äºæ‰“å°å’Œåˆ†äº«
            - **è´Ÿæ•°é‡‘é¢æ”¯æŒ**ï¼šè¿›è´¦å’Œæ±‡æ¬¾åŠŸèƒ½ç°åœ¨æ”¯æŒè´Ÿæ•°é‡‘é¢ï¼Œç”¨äºè®°å½•é€€æ¬¾æ“ä½œ
            - **è¿›è´¦é€€æ¬¾ç®¡ç†**ï¼šè¿›è´¦è®°å½•æ”¯æŒè´Ÿæ•°é‡‘é¢ï¼Œè¡¨ç¤ºå®¢æˆ·é€€æ¬¾ï¼Œè‡ªåŠ¨è°ƒæ•´ç»Ÿè®¡æ•°æ®
            - **æ±‡æ¬¾é€€æ¬¾ç®¡ç†**ï¼šæ±‡æ¬¾è®°å½•æ”¯æŒè´Ÿæ•°é‡‘é¢ï¼Œè¡¨ç¤ºä¾›åº”å•†é€€æ¬¾ï¼Œæ­£ç¡®è®¡ç®—å‘˜å·¥å‡€æ”¶å…¥
            
            #### ğŸ¨ UI æ”¹è¿›
            - **ä¾›åº”å•†å¾€æ¥ç•Œé¢ä¼˜åŒ–**ï¼šè®°å½•å¡ç‰‡è¯¦ç»†ä¿¡æ¯é‡‡ç”¨å¯¹é½å¸ƒå±€ï¼Œæ ‡ç­¾å’Œå†…å®¹åˆ†ç¦»æ˜¾ç¤ºï¼Œæå‡å¯è¯»æ€§
            - **é€€æ¬¾æ ‡è¯†**ï¼šè¿›è´¦å’Œæ±‡æ¬¾ç•Œé¢ä¸ºé€€æ¬¾è®°å½•æ·»åŠ é†’ç›®çš„ç»¿è‰²æ ‡ç­¾å’Œå›¾æ ‡
            - **é‡‘é¢æ˜¾ç¤ºä¼˜åŒ–**ï¼š
              - æ”¶æ¬¾/æ±‡æ¬¾ï¼šçº¢è‰²æ˜¾ç¤ºï¼Œå¸¦è´Ÿå·ï¼ˆ-Â¥100.00ï¼‰
              - é€€æ¬¾ï¼šç»¿è‰²æ˜¾ç¤ºï¼Œå¸¦æ­£å·ï¼ˆ+Â¥100.00ï¼‰
            - **é«˜çº§æœç´¢å¢å¼º**ï¼šæ”¯æŒæŒ‰"æ”¶æ¬¾/é€€æ¬¾"ã€"æ±‡æ¬¾/é€€æ¬¾"ç±»å‹ç­›é€‰
            - **å‘˜å·¥è®°å½•å®Œå–„**ï¼šæ±‡æ¬¾æ€»é¢ã€è¿›è´¦æ€»é¢ã€å¹³å‡å€¼ç­‰ç»Ÿè®¡æ­£ç¡®å¤„ç†è´Ÿæ•°ï¼Œé¿å…åŒé‡è´Ÿå·
            
            #### ğŸ› Bug ä¿®å¤
            - **åº“å­˜ç®¡ç†ä¿®å¤**ï¼šä¿®å¤ç¼–è¾‘é‡‡è´­è®°å½•æ—¶ä¿®æ”¹äº§å“å¯èƒ½å¯¼è‡´åº“å­˜è®¡ç®—é”™è¯¯çš„ä¸¥é‡ bug
            - **é‡‘é¢æ˜¾ç¤ºä¿®å¤**ï¼šä¿®å¤å‘˜å·¥è®°å½•ç•Œé¢æ±‡æ¬¾æ€»é¢æ˜¾ç¤ºä¸º "-Â¥-230.00" çš„é—®é¢˜
            - **ç»Ÿè®¡æ•°æ®ä¿®å¤**ï¼šä¿®å¤è¿›è´¦æ€»é¢ã€å¹³å‡è¿›è´¦ã€å¹³å‡æ±‡æ¬¾ç­‰ç»Ÿè®¡æŒ‡æ ‡çš„ç¬¦å·é”™è¯¯
            - **CSV å¯¼å‡ºä¿®å¤**ï¼šä¿®å¤å‘˜å·¥è®°å½• CSV å¯¼å‡ºä¸­è´Ÿæ•°è¿›è´¦æ ¼å¼é”™è¯¯ï¼ˆ+-80.0ï¼‰
            
            #### ğŸ”§ æŠ€æœ¯æ”¹è¿›
            - **æ•°æ®åº“å…¼å®¹æ€§**ï¼šREAL ç±»å‹å­—æ®µå¤©ç„¶æ”¯æŒè´Ÿæ•°ï¼Œæ— éœ€ä¿®æ”¹æ•°æ®åº“ schema
            - **å¯¼å‡ºæ ¼å¼ç»Ÿä¸€**ï¼šCSV å’Œ PDF å¯¼å‡ºæ­£ç¡®æ ¼å¼åŒ–æ­£è´Ÿæ•°é‡‘é¢
            - **è·¨ç•Œé¢ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ¶‰åŠè¿›è´¦/æ±‡æ¬¾çš„ç•Œé¢ï¼ˆè®°å½•åˆ—è¡¨ã€ç»Ÿè®¡æŠ¥è¡¨ã€å¯¼å‡ºæ–‡ä»¶ï¼‰ç»Ÿä¸€å¤„ç†è´Ÿæ•°
            - **æ„å»ºç³»ç»Ÿä¼˜åŒ–**ï¼š
              - macOS æ„å»ºæ–°å¢ DMG å®‰è£…åŒ…ï¼ˆæ¨èä½¿ç”¨ï¼‰
              - Windows æ„å»ºæ–°å¢ EXE å®‰è£…ç¨‹åºï¼ˆæ¨èä½¿ç”¨ï¼‰
              - Android æ„å»ºç§»é™¤ AAB æ–‡ä»¶ï¼Œä»…ä¿ç•™ APK
            
            #### ğŸ“š æ–‡æ¡£æ›´æ–°
            - **å¸®åŠ©æ–‡æ¡£å®Œå–„**ï¼šåœ¨"å…³äºç³»ç»Ÿ"é¡µé¢æ·»åŠ å®Œæ•´çš„ä½¿ç”¨å¸®åŠ©ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½è¯´æ˜
            - **ç‰ˆæœ¬ç®¡ç†è§„èŒƒ**ï¼šç»Ÿä¸€ç‰ˆæœ¬å·ç®¡ç†æµç¨‹ï¼Œç¡®ä¿è·¨å¹³å°ç‰ˆæœ¬ä¸€è‡´æ€§
            
            ---
            
            ### v2.9.0 æ›´æ–°å†…å®¹
            - æ–°å¢ä½¿ç”¨å¸®åŠ©æ–‡æ¡£ï¼šåœ¨"å…³äºç³»ç»Ÿ"é¡µé¢æ·»åŠ äº†å®Œæ•´çš„ä½¿ç”¨å¸®åŠ©ï¼ŒåŒ…å«ç³»ç»Ÿç®€ä»‹ã€åŠŸèƒ½è¯´æ˜ã€ä½¿ç”¨æŠ€å·§ç­‰
            - åº“å­˜ç®¡ç†ä¼˜åŒ–ï¼šä¿®å¤äº†ç¼–è¾‘é‡‡è´­è®°å½•æ—¶ä¿®æ”¹äº§å“å¯èƒ½å¯¼è‡´åº“å­˜è®¡ç®—é”™è¯¯çš„é—®é¢˜ï¼Œå¢å¼ºäº†åº“å­˜åˆæ³•æ€§æ£€æŸ¥
            - äº§å“ç®¡ç†ä¼˜åŒ–ï¼šä¼˜åŒ–äº†äº§å“æ·»åŠ /ç¼–è¾‘ç•Œé¢çš„å­—æ®µé¡ºåºï¼Œæ”¹å–„äº†ä¾›åº”å•†é€‰æ‹©æ¡†çš„è§†è§‰åé¦ˆ
            - æ•°æ®å®Œæ•´æ€§å¢å¼ºï¼šå®Œå–„äº†ç¼–è¾‘é‡‡è´­ã€é”€å”®ã€é€€è´§è®°å½•æ—¶çš„åº“å­˜éªŒè¯é€»è¾‘ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ€§
            - ç”¨æˆ·ä½“éªŒæå‡ï¼šä¼˜åŒ–äº†ç•Œé¢å¸ƒå±€å’Œäº¤äº’åé¦ˆï¼Œæå‡äº†æ•´ä½“ä½¿ç”¨ä½“éªŒ
            
            ### ğŸ“¥ ä¸‹è½½è¯´æ˜
            
            #### iOS ç”¨æˆ·
            - ä¸‹è½½ `agrisale-ios-${{ env.VERSION_TAG }}.ipa` æ–‡ä»¶
            
            #### Android ç”¨æˆ·
            - ä¸‹è½½ `agrisale-android-${{ env.VERSION_TAG }}.apk` æ–‡ä»¶
            
            #### macOS ç”¨æˆ·ï¼ˆæ¨è DMGï¼‰
            - **æ¨è**: `agrisale-macos-${{ env.VERSION_TAG }}.dmg` - æ ‡å‡†å®‰è£…åŒ…ï¼Œå¸¦å®‰è£…å‘å¯¼
            - **å¤‡é€‰**: `agrisale-macos-${{ env.VERSION_TAG }}.zip` - ç»¿è‰²ç‰ˆæœ¬ï¼Œè§£å‹å³ç”¨
            
            #### Windows ç”¨æˆ·ï¼ˆæ¨è EXEï¼‰
            - **æ¨è**: `agrisale-windows-${{ env.VERSION_TAG }}-installer.exe` - å®‰è£…å‘å¯¼ï¼Œè‡ªåŠ¨é…ç½®
            - **å¤‡é€‰**: `agrisale-windows-${{ env.VERSION_TAG }}.zip` - ç»¿è‰²ç‰ˆæœ¬ï¼Œè§£å‹å³ç”¨
            
            ### ğŸ“² å®‰è£…è¯´æ˜
            
            #### iOS
            - éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ AltStore æˆ–ä¼ä¸šè¯ä¹¦å®‰è£… IPA æ–‡ä»¶
            
            #### Android
            - å¼€å¯"æœªçŸ¥æ¥æºåº”ç”¨"åç›´æ¥å®‰è£… APK æ–‡ä»¶
            
            #### macOS
            - **DMG æ–‡ä»¶**ï¼ˆæ¨èï¼‰ï¼š
              1. åŒå‡» DMG æ–‡ä»¶æŒ‚è½½ç£ç›˜é•œåƒ
              2. å°† agrisale.app æ‹–æ‹½åˆ° Applications æ–‡ä»¶å¤¹
              3. é¦–æ¬¡æ‰“å¼€å¯èƒ½éœ€è¦åœ¨"ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§"ä¸­å…è®¸
            - **ZIP æ–‡ä»¶**ï¼š
              1. è§£å‹ ZIP æ–‡ä»¶
              2. å°† agrisale.app æ‹–æ‹½åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹
              3. é¦–æ¬¡æ‰“å¼€å¯èƒ½éœ€è¦åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸
            
            #### Windows
            - **EXE å®‰è£…ç¨‹åº**ï¼ˆæ¨èï¼‰ï¼š
              1. åŒå‡»è¿è¡Œå®‰è£…ç¨‹åº
              2. æŒ‰ç…§å®‰è£…å‘å¯¼æç¤ºå®Œæˆå®‰è£…
              3. è‡ªåŠ¨åˆ›å»ºå¼€å§‹èœå•å’Œæ¡Œé¢å¿«æ·æ–¹å¼ï¼ˆå¯é€‰ï¼‰
              4. å¯é€šè¿‡"æ·»åŠ /åˆ é™¤ç¨‹åº"å¸è½½
            - **ZIP æ–‡ä»¶**ï¼š
              1. è§£å‹åˆ°ä»»æ„æ–‡ä»¶å¤¹
              2. è¿è¡Œ agrisale.exe
              3. å¯æ‰‹åŠ¨åˆ›å»ºå¿«æ·æ–¹å¼
            
            ---
            
            å®Œæ•´è·¨å¹³å°æ”¯æŒ | åŸç”Ÿç”¨æˆ·ä½“éªŒ | å¼€æºå…è´¹
          files: |
            artifacts/iOS-Build/agrisale-ios-${{ env.VERSION_TAG }}.ipa
            artifacts/Android-APK/agrisale-android-${{ env.VERSION_TAG }}.apk
            artifacts/macOS-ZIP/agrisale-macos-${{ env.VERSION_TAG }}.zip
            artifacts/macOS-DMG/agrisale-macos-${{ env.VERSION_TAG }}.dmg
            artifacts/Windows-ZIP/agrisale-windows-${{ env.VERSION_TAG }}.zip
            artifacts/Windows-Installer/agrisale-windows-${{ env.VERSION_TAG }}-installer.exe
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

